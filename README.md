# Бот для расписания moodle
### Подробнее о проекте

Проект включает:

1. **Скрипт для обработки HTML расписаний (`app.py`)**
   - Парсит HTML-файлы с использованием библиотеки BeautifulSoup.
   - Извлекает данные о расписании и сохраняет их в базы данных SQLite.
   - Умеет обрабатывать сразу несколько HTML-файлов из указанной папки.

2. **Telegram-бот (`bot.py`)**
   - Реализован с использованием библиотеки `aiogram`.
   - Позволяет пользователям выбирать учебные группы и получать расписание на конкретную дату.
   - Работает с заранее созданными базами данных SQLite, соответствующими каждой группе.

---

### Установка и запуск

1. **Установка зависимостей**
   Создайте файл `requirements.txt` с таким содержанием:
   ```plaintext
   aiogram==3.0.0
   beautifulsoup4==4.12.2
   sqlite3
   ```

   Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

2. **Настройка**
   - Создайте папку `html` и поместите туда HTML-файлы с расписанием.
   - Убедитесь, что в `bot.py` значение переменной `API_TOKEN` заменено вашим токеном Telegram-бота.

3. **Запуск обработки расписаний**
   Выполните скрипт `app.py`, чтобы обработать HTML-файлы и создать базы данных:
   ```bash
   python app.py
   ```

4. **Запуск Telegram-бота**
   Запустите бота с помощью:
   ```bash
   python bot.py
   ```

---

### Использование

1. Запустите Telegram-бота, введя команду `/start`.
2. Выберите группу из предложенного списка.
3. Выберите дату (сегодня, завтра, или введите вручную).
4. Бот вернёт расписание для выбранной группы и даты.

---

### Структура файлов

- `app.py` — обрабатывает HTML-файлы и сохраняет расписание в базы данных.
- `bot.py` — Telegram-бот для взаимодействия с пользователями.
- `html/` — папка с HTML-файлами расписаний.

---

### Примечания

- Убедитесь, что структура HTML-файлов соответствует ожидаемой, иначе парсинг может не работать.
- При добавлении новых групп не забудьте обновить словарь `GROUPS` в `bot.py` с указанием имени базы данных для каждой группы.

---
### Пояснения по конфигурации бота

Для корректной работы Telegram-бота необходимо выполнить несколько шагов по настройке:

---

#### 1. **Получение API-токена**
- Зарегистрируйте бота в Telegram через [@BotFather](https://t.me/BotFather).
- Выполните команду `/newbot` и следуйте инструкциям.
- После завершения BotFather выдаст вам токен API. Сохраните его.

---

#### 2. **Указание токена в коде**
- Откройте файл `bot.py`.
- Найдите переменную `API_TOKEN` и замените её значение на полученный токен:
  ```python
  API_TOKEN = 'ВАШ_ТОКЕН'
  ```

---

#### 3. **Настройка групп**
- В словаре `GROUPS` в `bot.py` указываются соответствия между группами и файлами базы данных:
  ```python
  GROUPS = {
      'Р22К2': 'r22k2.db',
      'Р22Б1': 'r22b1.db',
      ...
  }
  ```
  - Ключами являются названия групп.
  - Значения — это имена SQLite-файлов, содержащих расписание для каждой группы.
  - Если добавляется новая группа, необходимо:
    1. Обработать соответствующий HTML-файл через `app.py`.
    2. Добавить новую пару "группа — файл базы данных" в словарь.

---

#### 4. **Обработка дат**
- Бот поддерживает выбор нескольких типов дат:
  - **Сегодня** — используется текущая дата.
  - **Завтра** — используется дата следующего дня.
  - **Произвольная дата** — пользователь вводит дату вручную в формате `dd.mm.yyyy`.

Если нужно добавить дополнительные опции для выбора даты, в коде можно обновить обработчики, связанные с `select_date` и кнопками.

---

#### 5. **Установка временного хранилища**
- Хранилище состояний для бота настроено в памяти (используется `MemoryStorage`):
  ```python
  storage = MemoryStorage()
  ```
  Если требуется сохранить состояния между запусками бота, замените на более устойчивое хранилище, например Redis или файл.

---

#### 6. **Запуск**
После настройки запустите бота:
```bash
python bot.py
```
